# Changelog

## 1.0.8 (2026-02-10)

### 🚀 新功能

- **DRC 忽略覆铜规则**：DRC 检查时可选择跳过覆铜相关违规（覆铜重铺后通常会自动解决）
- **重铺覆铜**：执行"圆滑全部"或"过渡线宽（全部）"后，自动重铺所有覆铜区域（调用未公开 API `rebuildCopperRegion()`，runtime 验证可用）
- 以上两个功能均在设置界面提供开关，默认开启

### 🚨 重大修复

- **圆弧线宽 10mil Bug**：修复快照恢复时，圆弧宽度变为默认 10mil 的严重 Bug（原因：`beautify.ts` 与 `snapshot.ts` 获取 `pcbId` 的逻辑不一致，导致 `arcWidthMap` 的 key 不匹配、查找失败，回退到 `getState_LineWidth()` 而该 API 对圆弧返回值不正确。修复：统一 pcbId 获取逻辑，并在创建圆弧时自行记录线宽至全局 Map）

### 🔧 重构

- **DRC 引擎重写**：基于实际 API 返回数据，定义完整 TypeScript 接口（`DrcCategory` → `DrcSubCategory` → `DrcIssue` 三级结构），替换原有递归遍历与模糊关键字匹配逻辑
- **覆铜检测精确化**：从宽泛的 `copper/pour/fill/plane` 关键字匹配改为精确的 `Copper Region` 字符串匹配，避免误杀（如 `copperThickness1oz` 规则名包含 copper 导致正常违规被忽略）
- **EDA 工具集**：将 `rebuildAllCopperPours()` / `rebuildAllCopperPoursIfEnabled()` 提取至 `eda_utils.ts`，供多个模块复用

### 📝 其他

- 更新 `DEVELOPER_NOTES.md`，补充 DRC API 三级数据结构文档、覆铜过滤策略、陷阱说明
- 清理无用的诊断日志和历史遗留代码
- 新增多条 i18n 翻译（覆铜重铺相关）

## 1.0.7 (2026-02-09)

### 🚀 核心升级 (线宽过渡偏移 & 快照管理V3 & 设置UI优化)

- **线宽过渡偏移**：生成位置是偏向于窄端/宽端可自行在 0-100% 调节
- **UI 交互优化**：设置界面的卡片现在支持鼠标拖拽排序，并支持记忆排序与折叠状态
- **快照持久化 V3**：重构存储底层，从全局单 Key 升级为按 PCB ID 独立存储，彻底解决大型项目中快照丢失的问题
- **数据压缩优化**：引入图元数据压缩（使用 sX, sY 等短键名），大幅降低存储空间占用
- **迁移支持**：实现从 V2 自动迁移旧快照至 V3 格式

### 🐛 修复

- 修复由于 JSON payload 过大导致 `sys_Storage` 写入静默失败的问题

## 1.0.6 (2026-02-08)

### 🚀 核心升级

- 将圆角半径设置从固定值改为比率模式
- DRC自动避让使用二分法自动尝试缩小半径避让
- 设置界面添加深色模式，根据系统主题自动切换
- 设置卡片添加折叠效果，怎么折都有...

### 📝 其他

- 移除单位选择下拉框
- 更新UI描述文本，改进用户体验
- 重新排列设置项顺序（过渡段数）
- 添加保存失败时的用户提示对话框
- 微调README文档，更新设置界面截图
- 为设置窗口添加最小化按钮（折叠按钮）
- 优化扩展关键字

## 1.0.5 (2026-02-07)

### 🚀 核心升级（DRC）

- 设计规则检查(DRC)设置，包含启用选项

### 🐛 修复

- 修复当选中一条线段时，点击菜单的 圆弧布线（全部）/ 线宽过渡（全部），不会触发进度条的BUG

### 📝 其他

- 添加 README.en.md

## 1.0.4 (2026-02-04)

### ✨ 优化

- 设置界面：全新UI布局，独立快照管理卡片；增加自动/手动快照视图切换
- 动画效果：优化刷新按钮交互，文档切换或数据刷新时播放丝滑的旋转动画

### 🚀 核心升级 (快照管理 V2)

- 智能分支：实现Git风格的时间线管理，撤销后产生新变更时自动截断无效的"未来"历史
- 深度去重：引入基于图元ID排序的深度比对算法，彻底解决乱序导致的假性重复快照
- 逻辑修正：修复撤销操作索引计算错误，消除跳过状态的Bug
- 代码重构：清理遗留代码，全面转移在 V2 存储结构

### 📝 其他

- 更新相关文档、设置界面图片
- 重命名扩展名称：熔化/优化/美化PCB (融化)

## 1.0.3-rc1 (2026-02-03)

### ✨ 新增

- 扩展名称和描述优化
- 中文翻译表达优化

## 1.0.2 (2026-02-02)

### ✨ 新增

- 重命名扩展名称：熔化PCB-美化PCB（融化）
- 添加"熔化"和"Melt"关键字
- 更新主页和问题链接

## 1.0.1 (2026-02-02)

### ✨ 新增

- 设置界面：支持简单的数学表达式运算；支持键盘上下按键、鼠标滚轮调整数值
- 设置界面：添加作者信息

### 🐛 修复

- 快照管理：添加PCB_ID检查，防止恢复错误快照；优化用户撤销体验，保存用户操作前后快照；手动创建快照时不与最新记录的快照重复
- 设置界面：修复JS警告，输入框合法检查
- 代码清洗：移除不必要无用代码，统一日志前缀格式

## 1.0.0 (2026-02-01)

### ✨ 功能

- 圆滑布线：将直角拐角转换为平滑圆弧
- 线宽过渡：不同线宽间平滑渐变，基于贝塞尔曲线
- 快照管理：一键备份/恢复布线状态
- 撤销支持：操作前自动备份，随时回退
- 设置界面：可配置圆角半径、过渡参数、快照选项等

### 📝 说明

- 支持选中处理和全局处理两种模式
- 圆弧基于实际圆弧图元，可二次编辑半径
- 线宽过渡智能限制，不超过窄端线长
